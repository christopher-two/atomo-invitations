---
interface Props {
    whatsappNumber: string;
}

const { whatsappNumber } = Astro.props;
---

<!-- 6. RSVP FORMULARIO -->
<section class="mb-12 relative max-w-2xl mx-auto">
    <div class="text-center mb-8 md:mb-12">
        <span
            class="marker-font text-6xl md:text-8xl text-[var(--pink-main)] transform -rotate-6 inline-block opacity-80"
            ><span
                class="theme-text"
                data-light="X O X O"
                data-dark="R S V P"
                data-emerald="R S V P"
                data-rose="X O X O"
                data-gold="R S V P">X O X O</span
            >
        </span>
    </div>

    <div
        class="bg-[var(--tape-bg)] p-6 md:p-10 rounded-lg shadow-sm border border-pink-100"
    >
        <h2 class="marker-font text-2xl md:text-4xl mb-6 text-center">
            <span
                class="theme-text"
                data-light="Â¡NO FALTES!"
                data-dark="Confirmar Asistencia"
                data-emerald="AcompÃ¡Ã±anos"
                data-rose="Â¡AcompÃ¡Ã±anos!"
                data-gold="Confirma Tu Asistencia">Â¡NO FALTES!</span
            >
        </h2>

        <form id="rsvpForm" class="space-y-8 text-xl md:text-2xl">
            <div class="flex flex-col gap-4 md:gap-6 mt-2">
                <span
                    class="theme-text"
                    data-light="Juro solemnemente que:"
                    data-dark="Por favor confirmar asistencia:"
                    data-emerald="Confirmo mi asistencia:"
                    data-rose="Â¿Podemos contar contigo?"
                    data-gold="Favor de confirmar:">Juro solemnemente que:</span
                >
                <label class="flex items-center gap-4 cursor-pointer group">
                    <div
                        class="w-8 h-8 md:w-10 md:h-10 hand-drawn-border flex items-center justify-center p-0 relative bg-white shrink-0"
                    >
                        <input
                            type="radio"
                            name="attendance"
                            value="yes"
                            required
                            class="opacity-0 absolute w-full h-full cursor-pointer peer"
                        />
                        <span
                            class="text-2xl md:text-3xl text-[var(--charcoal)] hidden peer-checked:block marker-font mt-1"
                            >X</span
                        >
                    </div>
                    <span
                        class="group-hover:text-[var(--pink-main)] transition-colors inline-flex items-center"
                        ><span
                            class="theme-text"
                            data-light="Â¡Obvio voy a ir!"
                            data-dark="SÃ­, asistirÃ©"
                            data-emerald="SÃ­, ahÃ­ estarÃ©"
                            data-rose="Â¡SÃ­, me encantarÃ­a!"
                            data-gold="Con gusto asistirÃ©"
                            >Â¡Obvio voy a ir!</span
                        >
                        <i
                            class="theme-icon fa-solid fa-wand-magic-sparkles text-[var(--pink-main)] ml-2 mt-1"
                            data-light="fa-solid fa-wand-magic-sparkles"
                            data-dark="fa-solid fa-check"
                            data-emerald="fa-solid fa-check-double"
                            data-rose="fa-solid fa-heart"
                            data-gold="fa-solid fa-check"
                            data-current-icon-class="fa-solid fa-wand-magic-sparkles"
                        ></i>
                    </span>
                </label>

                <label class="flex items-center gap-4 cursor-pointer group">
                    <div
                        class="w-8 h-8 md:w-10 md:h-10 hand-drawn-border flex items-center justify-center p-0 relative bg-white shrink-0"
                    >
                        <input
                            type="radio"
                            name="attendance"
                            value="no"
                            class="opacity-0 absolute w-full h-full cursor-pointer peer"
                        />
                        <span
                            class="text-2xl md:text-3xl text-[var(--charcoal)] hidden peer-checked:block marker-font mt-1"
                            >X</span
                        >
                    </div>
                    <span
                        class="group-hover:text-gray-500 transition-colors inline-flex items-center"
                        ><span
                            class="theme-text"
                            data-light="Me lo pierdo"
                            data-dark="No podrÃ© asistir"
                            data-emerald="Lamentablemente no"
                            data-rose="Me lo pierdo"
                            data-gold="Declino con pesar">Me lo pierdo</span
                        >
                        <i
                            class="theme-icon fa-solid fa-face-sad-tear ml-2 mt-1"
                            data-light="fa-solid fa-face-sad-tear"
                            data-dark="fa-solid fa-xmark"
                            data-emerald="fa-solid fa-xmark"
                            data-rose="fa-solid fa-face-frown"
                            data-gold="fa-solid fa-xmark"
                            data-current-icon-class="fa-solid fa-face-sad-tear"
                        ></i>
                    </span>
                </label>
            </div>

            <div class="text-center mt-10">
                <button
                    type="submit"
                    class="hand-drawn-border text-2xl md:text-4xl marker-font text-[var(--pink-main)] hover:text-white hover:bg-[var(--pink-main)] transition-all px-10 py-3"
                >
                    ENVIAR
                </button>
            </div>
        </form>
    </div>

    <!-- Lazo decorativo final -->
    <div
        class="sticker text-7xl md:text-9xl -bottom-10 -left-10 md:-left-20 transform -rotate-12"
    >
        <i class="fa-solid fa-ribbon text-[var(--pink-main)] opacity-80"></i>
    </div>
    <svg
        class="sparkle bottom-0 right-4 md:-right-12 w-8 h-8 md:w-16 md:h-16"
        viewBox="0 0 24 24"
        style="animation-delay: 1.5s;"
        ><path
            d="M12 0L13.5 8.5L22 10L13.5 11.5L12 20L10.5 11.5L2 10L10.5 8.5L12 0Z"
            class="svg-pink"></path>
    </svg>
</section>

<script define:vars={{ whatsappNumber }}>
    // MANEJO DEL FORMULARIO (RSVP) A WHATSAPP
    const form = document.getElementById("rsvpForm");
    if (form) {
        form.addEventListener("submit", (e) => {
            e.preventDefault();

            const attendingInput = document.querySelector(
                'input[name="attendance"]:checked'
            );
            if (!attendingInput) return;

            const attending = attendingInput.value;

            const currentTheme = localStorage.getItem("theme") || "light";
            let mensaje = "";

            if (currentTheme === "light") {
                mensaje =
                    attending === "yes"
                        ? "Â¡Hola! Juro solemnemente que Â¡Obvio voy a ir! a la Noche de Chicas. ðŸ’…âœ¨ Nos vemos ahÃ­."
                        : "Â¡Hola! Lloraremos, pero me lo pierdo. No podrÃ© ir a la Noche de Chicas. ðŸ˜­ðŸ’”";
            } else if (currentTheme === "dark") {
                mensaje =
                    attending === "yes"
                        ? "Â¡Hola! Confirmo mi asistencia a la Noche de Gala."
                        : "Â¡Hola! Lamentablemente no podrÃ© asistir a la Noche de Gala.";
            } else if (currentTheme === "emerald") {
                mensaje =
                    attending === "yes"
                        ? "Â¡Hola! Confirmo mi asistencia a la GraduaciÃ³n."
                        : "Â¡Hola! Me es imposible asistir a la GraduaciÃ³n.";
            } else if (currentTheme === "rose") {
                mensaje =
                    attending === "yes"
                        ? "Â¡Hola! Claro que sÃ­, Â¡me encantarÃ­a asistir a la Despedida de Soltera! ðŸ’•"
                        : "Â¡Hola! QuÃ© pena, no podrÃ© acompaÃ±arlas en la Despedida. Â¡PÃ¡senla increÃ­ble!";
            } else if (currentTheme === "gold") {
                mensaje =
                    attending === "yes"
                        ? "Â¡Hola! Con gusto confirmo mi asistencia al Aniversario."
                        : "Â¡Hola! Agradezco la invitaciÃ³n, pero declino con pesar la asistencia al Aniversario.";
            }

            const url = `https://wa.me/${whatsappNumber}?text=${encodeURIComponent(
                mensaje
            )}`;
            window.open(url, "_blank");
        });
    }
</script>
