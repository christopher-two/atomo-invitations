---
import "./styles/variables.css";
import ThemeToggle from "../../ThemeToggle.astro";
import Footer from "../../Footer.astro";
import SEO from "../../SEO.astro";

interface Props {
    title: string;
}

const { title } = Astro.props;
---

<!DOCTYPE html>
<html lang="es">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
        <meta name="generator" content={Astro.generator} />
        <SEO title={title} />

        <!-- Google Fonts: Cinzel, Cormorant Garamond, Quicksand -->
        <link rel="preconnect" href="https://fonts.googleapis.com" />
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
        <link
            href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;600;700&family=Cormorant+Garamond:ital,wght@0,300;0,400;0,600;1,400&family=Quicksand:wght@300;400;600&display=swap"
            rel="stylesheet"
        />

        <!-- Phosphor Icons -->
        <script src="https://unpkg.com/@phosphor-icons/web"></script>
    </head>
    <body class="hp-body">
        <ThemeToggle allowedThemes={["light", "dark"]} />

        <!-- Definición de SVGs para reciclar (Huellas de zapatos) -->
        <svg style="display: none;">
            <symbol id="foot-left" viewBox="0 0 30 50">
                <path
                    d="M12,0 C4,0 0,10 4,22 C7,31 16,33 20,25 C26,13 22,0 12,0 Z"
                    fill="currentColor"></path>
                <ellipse cx="15" cy="42" rx="7" ry="8" fill="currentColor"
                ></ellipse>
            </symbol>
            <symbol id="foot-right" viewBox="0 0 30 50">
                <path
                    d="M18,0 C26,0 30,10 26,22 C23,31 14,33 10,25 C4,13 8,0 18,0 Z"
                    fill="currentColor"></path>
                <ellipse cx="15" cy="42" rx="7" ry="8" fill="currentColor"
                ></ellipse>
            </symbol>
        </svg>

        <!-- Fondo Animado: Mapa del Merodeador -->
        <div class="hp-map-bg">
            <!-- Caminos y habitaciones dibujadas -->
            <svg
                class="hp-map-lines"
                viewBox="0 0 1000 1000"
                preserveAspectRatio="xMidYMid slice"
                xmlns="http://www.w3.org/2000/svg"
            >
                <path
                    class="hp-map-line hp-flow-line"
                    d="M -100,200 Q 300,300 400,600 T 900,800"></path>
                <path
                    class="hp-map-line hp-flow-line"
                    style="animation-direction: reverse; animation-duration: 35s;"
                    d="M 1100,100 Q 700,400 800,900 T 300,1200"></path>
                <path
                    class="hp-map-line hp-flow-line"
                    style="animation-duration: 50s;"
                    d="M -100,800 Q 400,700 600,1100"></path>

                <path
                    class="hp-map-line"
                    d="M 100,100 L 300,100 L 300,300 L 150,300 L 150,200 L 100,200 Z"
                ></path>
                <circle cx="800" cy="700" r="150" class="hp-map-line"></circle>
                <rect
                    x="700"
                    y="200"
                    width="200"
                    height="100"
                    rx="10"
                    class="hp-map-line"></rect>
                <path
                    class="hp-map-line"
                    d="M 400,0 L 400,200 Q 400,300 500,300 L 700,300"></path>
            </svg>

            <!-- Huellas animadas 1 -->
            <div
                class="hp-footprints"
                style="top: 15%; left: 10%; transform: rotate(45deg);"
            >
                <svg
                    class="hp-foot-walk hp-walk-1"
                    style="transform: translate(0px, 0px)"
                    ><use href="#foot-left"></use>
                </svg>
                <svg
                    class="hp-foot-walk hp-walk-2"
                    style="transform: translate(15px, -20px)"
                    ><use href="#foot-right"></use>
                </svg>
                <svg
                    class="hp-foot-walk hp-walk-3"
                    style="transform: translate(0px, -40px)"
                    ><use href="#foot-left"></use>
                </svg>
                <svg
                    class="hp-foot-walk hp-walk-4"
                    style="transform: translate(15px, -60px)"
                    ><use href="#foot-right"></use>
                </svg>
                <svg
                    class="hp-foot-walk hp-walk-5"
                    style="transform: translate(0px, -80px)"
                    ><use href="#foot-left"></use>
                </svg>
                <svg
                    class="hp-foot-walk hp-walk-6"
                    style="transform: translate(15px, -100px)"
                    ><use href="#foot-right"></use>
                </svg>
            </div>

            <!-- Huellas animadas 2 -->
            <div
                class="hp-footprints"
                style="top: 60%; right: 20%; transform: rotate(-60deg);"
            >
                <svg
                    class="hp-foot-walk hp-walk-1"
                    style="transform: translate(0px, 0px)"
                    ><use href="#foot-left"></use>
                </svg>
                <svg
                    class="hp-foot-walk hp-walk-2"
                    style="transform: translate(15px, -20px)"
                    ><use href="#foot-right"></use>
                </svg>
                <svg
                    class="hp-foot-walk hp-walk-3"
                    style="transform: translate(0px, -40px)"
                    ><use href="#foot-left"></use>
                </svg>
                <svg
                    class="hp-foot-walk hp-walk-4"
                    style="transform: translate(15px, -60px)"
                    ><use href="#foot-right"></use>
                </svg>
                <svg
                    class="hp-foot-walk hp-walk-5"
                    style="transform: translate(0px, -80px)"
                    ><use href="#foot-left"></use>
                </svg>
                <svg
                    class="hp-foot-walk hp-walk-6"
                    style="transform: translate(15px, -100px)"
                    ><use href="#foot-right"></use>
                </svg>
            </div>

            <!-- Huellas animadas 3 -->
            <div
                class="hp-footprints"
                style="top: 20%; left: 30%; transform: rotate(80deg);"
            >
                <svg
                    class="hp-foot-walk hp-walk-1"
                    style="transform: translate(0px, 0px)"
                    ><use href="#foot-left"></use>
                </svg>
                <svg
                    class="hp-foot-walk hp-walk-2"
                    style="transform: translate(15px, -20px)"
                    ><use href="#foot-right"></use>
                </svg>
                <svg
                    class="hp-foot-walk hp-walk-3"
                    style="transform: translate(0px, -40px)"
                    ><use href="#foot-left"></use>
                </svg>
                <svg
                    class="hp-foot-walk hp-walk-4"
                    style="transform: translate(15px, -60px)"
                    ><use href="#foot-right"></use>
                </svg>
                <svg
                    class="hp-foot-walk hp-walk-5"
                    style="transform: translate(0px, -80px)"
                    ><use href="#foot-left"></use>
                </svg>
                <svg
                    class="hp-foot-walk hp-walk-6"
                    style="transform: translate(15px, -100px)"
                    ><use href="#foot-right"></use>
                </svg>
            </div>

            <!-- Efecto Lumos (Luz radial animada interactuando con las líneas) -->
            <div class="hp-bg-lumos-glow"></div>

            <!-- Varita en el fondo -->
            <div class="hp-bg-wand-container">
                <svg
                    viewBox="0 0 100 100"
                    class="hp-bg-wand-svg"
                    fill="none"
                    stroke="currentColor"
                >
                    <circle
                        cx="95"
                        cy="5"
                        r="3"
                        class="hp-bg-wand-tip-glow"
                        fill="#fcd34d"
                        stroke="none"></circle>
                    <circle cx="95" cy="5" r="1.5" fill="#fff" stroke="none"
                    ></circle>
                    <path
                        d="M 95 0 L 95 -5 M 95 10 L 95 15 M 90 5 L 85 5 M 100 5 L 105 5 M 91.5 1.5 L 89 -1 M 98.5 8.5 L 101 11 M 91.5 8.5 L 89 11 M 98.5 1.5 L 101 -1"
                        stroke="#fcd34d"
                        stroke-width="1"
                        class="hp-bg-wand-sparks"></path>
                    <path
                        d="M 5 95 L 92 8"
                        stroke="var(--color-ink)"
                        stroke-width="4"
                        stroke-linecap="round"></path>
                    <circle
                        cx="20"
                        cy="80"
                        r="3.5"
                        fill="var(--color-ink)"
                        stroke="none"></circle>
                    <circle
                        cx="40"
                        cy="60"
                        r="3.5"
                        fill="var(--color-ink)"
                        stroke="none"></circle>
                    <circle
                        cx="60"
                        cy="40"
                        r="3"
                        fill="var(--color-ink)"
                        stroke="none"></circle>
                    <circle
                        cx="75"
                        cy="25"
                        r="2.5"
                        fill="var(--color-ink)"
                        stroke="none"></circle>
                    <path
                        d="M 3 97 L 25 75"
                        stroke="var(--color-ink)"
                        stroke-width="6"
                        stroke-linecap="round"></path>
                </svg>
            </div>
        </div>

        <main class="hp-main">
            <slot />
        </main>

        <Footer />

        <style is:global>
            html,
            body {
                max-width: 100%;
                overflow-x: hidden;
            }

            body {
                /* Textura base y color de pergamino con bordes oscurecidos (viñeta) */
                background-color: var(--color-bg);
                background-image: radial-gradient(
                        circle at center,
                        transparent 40%,
                        rgba(139, 69, 19, 0.15) 100%
                    ),
                    url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.85' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)' opacity='0.05'/%3E%3C/svg%3E");
                color: var(--color-text);
                font-family: var(--font-classic);
                font-size: 1.125rem; /* text-lg */
                transition: background-color 0.5s, color 0.5s;
                -webkit-font-smoothing: antialiased;
            }

            /* Selection styling */
            ::selection {
                background-color: var(--color-ink-red);
                color: var(--color-parchment);
            }

            .hp-main {
                width: 100%;
                max-width: 28rem; /* max-w-md */
                margin: 0 auto;
                position: relative;
                z-index: 10;
            }

            /* Util clases para tipografías */
            .font-magic {
                font-family: var(--font-magic);
            }
            .font-classic {
                font-family: var(--font-classic);
            }
            .font-sans-hp {
                font-family: var(--font-sans);
            }

            /* Fondo de mapa */
            .hp-map-bg {
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                z-index: 0;
                pointer-events: none;
                opacity: 0.3;
            }

            .hp-map-lines {
                position: absolute;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
            }

            .hp-map-line {
                fill: none;
                stroke: var(--color-ink-light);
                stroke-width: 2;
                stroke-dasharray: 8 12;
                stroke-linecap: round;
            }

            .hp-flow-line {
                animation: hp-flow 40s linear infinite;
            }

            .hp-footprints {
                position: absolute;
            }

            .hp-foot-walk {
                position: absolute;
                width: 14px;
                height: 24px;
                color: var(--color-ink-red);
                opacity: 0;
            }

            .hp-walk-1 {
                animation: hp-stepFade 4.5s infinite 0s;
            }
            .hp-walk-2 {
                animation: hp-stepFade 4.5s infinite 0.5s;
            }
            .hp-walk-3 {
                animation: hp-stepFade 4.5s infinite 1s;
            }
            .hp-walk-4 {
                animation: hp-stepFade 4.5s infinite 1.5s;
            }
            .hp-walk-5 {
                animation: hp-stepFade 4.5s infinite 2s;
            }
            .hp-walk-6 {
                animation: hp-stepFade 4.5s infinite 2.5s;
            }

            .hp-levitate {
                animation: hp-levitate 4s ease-in-out infinite;
            }

            .hp-bounce {
                animation: hp-bounce 2s infinite;
            }

            /* Lumos Effect en Background */
            .hp-bg-lumos-glow {
                position: fixed;
                width: 60vh;
                height: 60vh;
                max-width: 600px;
                max-height: 600px;
                bottom: -15vh;
                left: -15vh;
                background: radial-gradient(
                    circle at center,
                    rgba(252, 211, 77, 0.4) 0%,
                    rgba(252, 211, 77, 0.2) 20%,
                    rgba(252, 211, 77, 0.05) 50%,
                    transparent 70%
                );
                pointer-events: none;
                border-radius: 50%;
                animation: hp-bg-lumos-pulse 4s ease-in-out infinite alternate;
                z-index: 10; /* Above map paths */
                mix-blend-mode: overlay;
            }

            @keyframes hp-bg-lumos-pulse {
                0% {
                    transform: scale(0.95);
                    opacity: 0.7;
                }
                50% {
                    transform: scale(1.05);
                    opacity: 1;
                }
                100% {
                    transform: scale(0.98);
                    opacity: 0.8;
                }
            }

            .hp-bg-wand-container {
                position: fixed;
                bottom: -5vh;
                left: -5vh;
                width: 25vh;
                height: 25vh;
                max-width: 300px;
                max-height: 300px;
                z-index: 11;
                pointer-events: none;
                animation: hp-bg-wand-hover 6s ease-in-out infinite;
                transform-origin: bottom left;
                filter: drop-shadow(3px 6px 10px rgba(0, 0, 0, 0.3));
            }

            .hp-bg-wand-svg {
                width: 100%;
                height: 100%;
            }

            .hp-bg-wand-tip-glow {
                animation: hp-bg-tip-flicker 2s infinite alternate;
            }

            .hp-bg-wand-sparks {
                animation: hp-bg-sparks-flicker 1.5s infinite alternate;
                transform-origin: 95px 5px;
            }

            @keyframes hp-bg-wand-hover {
                0%,
                100% {
                    transform: rotate(0deg) translateY(0);
                }
                50% {
                    transform: rotate(3deg) translateY(-10px);
                }
            }

            @keyframes hp-bg-tip-flicker {
                0% {
                    r: 3;
                    fill: #fcd34d;
                    opacity: 0.8;
                }
                100% {
                    r: 6;
                    fill: #fff;
                    opacity: 1;
                }
            }

            @keyframes hp-bg-sparks-flicker {
                0% {
                    transform: scale(0.8) rotate(0deg);
                    opacity: 0.5;
                }
                100% {
                    transform: scale(1.3) rotate(45deg);
                    opacity: 1;
                }
            }

            /* Adjust glow based on theme */
            [data-theme="dark"] .hp-bg-lumos-glow {
                background: radial-gradient(
                    circle at center,
                    rgba(252, 211, 77, 0.25) 0%,
                    rgba(252, 211, 77, 0.1) 30%,
                    transparent 70%
                );
                mix-blend-mode: color-dodge;
            }
        </style>
    </body>
</html>
