---
import floral from "../assets/floral-1.svg?raw";
const innerSVG = floral.replace(
    /[\s\S]*<svg[^>]*>([\s\S]*?)<\/svg>[\s\S]*/,
    "$1"
);

const { invitation, profile } = Astro.props;

// Use a fallback date if none provided
const eventDate = invitation?.event_date
    ? new Date(invitation.event_date).getTime()
    : new Date(2026, 2, 20, 16, 0, 0).getTime();
---

<section class="countdown-section">
    <!-- Hojas de fondo inferiores (Copia exacta de RSVP) -->
    <svg class="botanical-decoration bottom-left" viewBox="0 0 512 512">
        <g transform="rotate(-20 256 256) scale(0.9)" set:html={innerSVG}></g>
    </svg>
    <svg class="botanical-decoration bottom-right" viewBox="0 0 512 512">
        <g transform="rotate(-20 256 256) scale(0.9)" set:html={innerSVG}></g>
    </svg>
    <div class="countdown-container" data-date={eventDate}>
        <div class="countdown-item">
            <span id="dias" class="countdown-number">00</span>
            <span class="countdown-label">DÍAS</span>
        </div>
        <div class="countdown-item">
            <span id="horas" class="countdown-number">00</span>
            <span class="countdown-label">HRS</span>
        </div>
        <div class="countdown-item">
            <span id="minutos" class="countdown-number">00</span>
            <span class="countdown-label">MIN</span>
        </div>
        <div class="countdown-item">
            <span id="segundos" class="countdown-number">00</span>
            <span class="countdown-label">SEG</span>
        </div>
    </div>

    <!-- Separador -->
    <div class="divider"></div>
</section>

<script>
    // Lógica del Contador Regresivo
    const container = document.querySelector(".countdown-container");
    const dbDate = container
        ? Number(container.getAttribute("data-date"))
        : new Date().getTime();
    const fechaBoda =
        isNaN(dbDate) || dbDate === 0 ? new Date().getTime() : dbDate;

    const diasEl = document.getElementById("dias");
    const horasEl = document.getElementById("horas");
    const minutosEl = document.getElementById("minutos");
    const segundosEl = document.getElementById("segundos");

    const intervalo = setInterval(function () {
        const ahora = new Date().getTime();
        const distancia = fechaBoda - ahora;

        if (distancia < 0) {
            clearInterval(intervalo);
            if (diasEl) diasEl.innerText = "00";
            if (horasEl) horasEl.innerText = "00";
            if (minutosEl) minutosEl.innerText = "00";
            if (segundosEl) segundosEl.innerText = "00";
            return;
        }

        const dias = Math.floor(distancia / (1000 * 60 * 60 * 24));
        const horas = Math.floor(
            (distancia % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60)
        );
        const minutos = Math.floor(
            (distancia % (1000 * 60 * 60)) / (1000 * 60)
        );
        const segundos = Math.floor((distancia % (1000 * 60)) / 1000);

        if (diasEl)
            diasEl.innerText = (dias < 10 ? "0" + dias : dias).toString();
        if (horasEl)
            horasEl.innerText = (horas < 10 ? "0" + horas : horas).toString();
        if (minutosEl)
            minutosEl.innerText = (
                minutos < 10 ? "0" + minutos : minutos
            ).toString();
        if (segundosEl)
            segundosEl.innerText = (
                segundos < 10 ? "0" + segundos : segundos
            ).toString();
    }, 1000);
</script>

<style>
    .countdown-section {
        position: relative;
        padding: 2rem 1.5rem 5rem;
        display: flex;
        flex-direction: column;
        align-items: center;
        width: 100%;
        overflow: hidden;
    }

    .botanical-decoration {
        position: absolute;
        bottom: -2rem;
        width: 15rem;
        height: 15rem;
        opacity: 0.7;
        pointer-events: none;
        color: var(--color-verde);
    }

    .bottom-left {
        left: -3rem;
        transform: scaleY(1);
    }

    .bottom-right {
        right: -3rem;
        transform: scale(-1, 1);
    }

    .countdown-container {
        display: flex;
        justify-content: center;
        gap: 1.5rem;
        width: 100%;
        max-width: 32rem;
        margin-bottom: 3rem;
    }

    .countdown-item {
        display: flex;
        flex-direction: column;
        align-items: center;
    }

    .countdown-number {
        font-family: var(--font-serif);
        font-size: 3rem;
        color: var(--color-verde);
    }

    .countdown-label {
        font-family: var(--font-sans);
        font-size: 0.75rem;
        letter-spacing: 0.15em;
        margin-top: 0.5rem;
        color: var(--color-carbon);
    }

    .divider {
        width: 33.333%;
        height: 1px;
        background-color: var(--color-verde);
        opacity: 0.5;
    }

    @media (min-width: 768px) {
        .countdown-section {
            padding: 3rem 1.5rem 5rem;
        }

        .botanical-decoration {
            width: 30rem;
            height: 30rem;
            bottom: -5rem;
        }

        .bottom-left {
            left: -5rem;
        }

        .bottom-right {
            right: -5rem;
        }

        .countdown-container {
            gap: 3rem;
            max-width: 48rem;
        }

        .countdown-number {
            font-size: 5rem;
        }

        .countdown-label {
            font-size: 1rem;
        }

        .divider {
            width: 20%;
        }
    }
</style>
